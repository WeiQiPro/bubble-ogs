<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"
      integrity="sha512-zoJXRvW2gC8Z0Xo3lBbao5+AS3g6YWr5ztKqaicua11xHo+AvE1b0lT9ODgrHTmNUxeCw0Ry4BGRYZfXu70weg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
  </head>

  <body>
    <script>
let OGS={set:!1};class Board{constructor(){this.grid=Array.from({length:19},(()=>Array(19).fill(""))),this.size=19}playMove(t,e){const[n,r,o=0]=t,s="b"===e?"w":"b";this.grid[n][r]=e;this.findGroups().forEach((({color:t,group:e})=>{t===s&&0===this.calculateLiberties(e)&&e.forEach((([t,e])=>this.grid[t][e]=""))}))}findGroups(){const t=[],e=Array(this.size).fill(!1).map((()=>Array(this.size).fill(!1))),n=[[-1,0],[1,0],[0,-1],[0,1]];for(let r=0;r<this.size;r++)for(let o=0;o<this.size;o++){const s=this.grid[r][o];if(s&&!e[r][o]){const l=[],i=[[r,o]];for(;i.length>0;){const[t,r]=i.pop();if(!e[t][r]){e[t][r]=!0,l.push([t,r]);for(const[o,l]of n){const n=t+o,u=r+l;n<0||n>=this.size||u<0||u>=this.size||(this.grid[n][u]!==s||e[n][u]||i.push([n,u]))}}}t.push({color:s,group:l})}}return t}calculateLiberties(t){const e=new Set,n=[[-1,0],[1,0],[0,-1],[0,1]];for(const[r,o]of t)for(const[t,s]of n){const n=r+t,l=o+s;n<0||n>=this.size||l<0||l>=this.size||""===this.grid[n][l]&&e.add([n,l].toString())}return e.size}state(t){return this.grid=Array.from({length:19},(()=>Array(19).fill(""))),t.length>0&&t.forEach((e=>{const[n,r]=e,o=t.indexOf(e)%2==0?"b":"w";-1!=n&&-1!=r&&this.playMove(e,o)})),this.grid}}function start(t){const e=new Image;e.src=t.param1;const n=new Image;n.src=t.param2;const r=new Image;r.src=t.param3;domloader(document.querySelectorAll(".goban"),e,n,r)}function domloader(t,e,n,r){0==OGS.set?(OGS=loadSocket(),OGS.set=!0,OGS.board=new Board,OGS.GAMES={},t.forEach((t=>{const o=t.innerText,[s,l]=o.split("/").map((t=>t.split(":")[1]));createGoBoardSVG(t.id,e,s,l),OGS.GAMES[l]={id:l,type:s,moves:[],state:[]},subscribeToGames(OGS,s,l,n,r)}))):Object.keys(OGS.GAMES).forEach((t=>{const e=OGS.GAMES[t];let o=e.id,s=e.type,l=e.moves;updateBoard(e.state,s,o,n,r),markCurrentMove(l[l.length-1],s,o,n)}))}function subscribeToGames(t,e,n,r,o){if("game"===e)t.emit("game/connect",{game_id:n,chat:!1}),t.on("game/"+n+"/gamedata",(s=>{if("finished"===s.phase){console.log("game has finished");const l=s.moves;return t.GAMES[n].moves=l,t.GAMES[n].state=t.board.state(l),updateBoard(t.GAMES[n].state,e,n,r,o),markCurrentMove(l[l.length-1],e,n,r),void t.send(["game/disconnect",{game_id:n}])}if(!s.moves)return;const l=s.moves;t.GAMES[n].moves=l,t.GAMES[n].state=t.board.state(l),updateBoard(t.GAMES[n].state,e,n,r,o),markCurrentMove(l[l.length-1],e,n,r)})),t.on("game/"+n+"/move",(s=>{if(!s.move)return;const l=s.move;t.GAMES[n].moves.push(l),t.GAMES[n].state=t.board.state(t.GAMES[n].moves),updateBoard(t.GAMES[n].state,e,n,r,o),markCurrentMove(l,e,n,r)}));else{if("review"!==e)return;t.emit("review/connect",{review_id:n,chat:!1})}}function markCurrentMove(t,e,n,r){const[o,s,l=0]=t;let i=document.getElementById(`stone-${o}-${s}-${e}-${n}`);if(i){let t=i.parentNode;const l=i.getAttribute("href")==r.src?"#e8e8e8":"#111111";let u=document.getElementById(`current-move-${e}-${n}`);u&&u.remove();let c=parseFloat(i.getAttribute("width"))/2,a=document.createElementNS("http://www.w3.org/2000/svg","circle"),d=parseFloat(i.getAttribute("x"))+c,m=parseFloat(i.getAttribute("y"))+c;a.setAttribute("cx",d),a.setAttribute("cy",m),a.setAttribute("r",.5*c),a.setAttribute("stroke-width","2.6315789473684212"),a.setAttribute("fill","none"),a.setAttribute("class","circle-label"),a.setAttribute("stroke",l),a.setAttribute("id",`current-move-${e}-${n}`),a.setAttribute("class",`current-move-${o}-${s}-${e}-${n}`),t.appendChild(a)}}function updateBoard(t,e,n,r,o){for(let s=0;s<19;s++)for(let l=0;l<19;l++){let i=document.getElementById(`stone-${s}-${l}-${e}-${n}`);i&&("b"===t[s][l]?i.setAttribute("href",r.src):"w"===t[s][l]?i.setAttribute("href",o.src):i.setAttribute("href",""))}}function createGoBoardSVG(t,e,n,r){const o="http://www.w3.org/2000/svg",s=19,l=50,i=600,u=i/18,c=document.createElementNS(o,"svg");c.setAttributeNS(null,"viewBox","0 0 700 700"),c.setAttributeNS(null,"class","board"),c.setAttributeNS(null,"id",`board-${n}-${r}`),c.style.overflow="visible",c.style.width="100%",c.style.height="100%";const a=document.createElementNS(o,"rect");a.setAttributeNS(null,"x",l),a.setAttributeNS(null,"y",l),a.setAttributeNS(null,"width",i),a.setAttributeNS(null,"height",i),a.setAttributeNS(null,"fill","rgba(0, 0, 0, 0.05)"),c.appendChild(a);const d=document.createElementNS(o,"g");d.setAttributeNS(null,"class","label"),c.appendChild(d);const m=document.createElementNS(o,"g");m.setAttributeNS(null,"class","lines"),c.appendChild(m);for(let t=0;t<s;t++){const e=l+t*u,n=document.createElementNS(o,"line");n.setAttributeNS(null,"x1",l),n.setAttributeNS(null,"y1",e),n.setAttributeNS(null,"x2",650),n.setAttributeNS(null,"y2",e),n.setAttributeNS(null,"stroke","#000"),m.appendChild(n);const r=document.createElementNS(o,"line");r.setAttributeNS(null,"x1",e),r.setAttributeNS(null,"y1",l),r.setAttributeNS(null,"x2",e),r.setAttributeNS(null,"y2",650),r.setAttributeNS(null,"stroke","#000"),m.appendChild(r)}[{x:3,y:3},{x:9,y:3},{x:15,y:3},{x:3,y:9},{x:9,y:9},{x:15,y:9},{x:3,y:15},{x:9,y:15},{x:15,y:15}].forEach((t=>{const e=document.createElementNS(o,"circle");e.setAttributeNS(null,"cx",l+t.x*u),e.setAttributeNS(null,"cy",l+t.y*u),e.setAttributeNS(null,"r",5),e.setAttributeNS(null,"fill","#000"),c.appendChild(e)}));for(let t=0;t<s;t++){const e=l+t*u,n=s-t,r=String.fromCharCode("A".charCodeAt(0)+(t>=8?t+1:t)),i=document.createElementNS(o,"text");i.setAttributeNS(null,"x",e),i.setAttributeNS(null,"y",25),i.setAttributeNS(null,"font-size","21"),i.setAttributeNS(null,"text-anchor","middle"),i.setAttributeNS(null,"dy","0.35em"),i.setAttributeNS(null,"stroke","#080808"),i.setAttributeNS(null,"fill","#080808"),i.textContent=r,d.appendChild(i);const c=i.cloneNode(!0);c.setAttributeNS(null,"y",675),d.appendChild(c);const a=document.createElementNS(o,"text");a.setAttributeNS(null,"x",25),a.setAttributeNS(null,"y",e),a.setAttributeNS(null,"font-size","21"),a.setAttributeNS(null,"text-anchor","middle"),a.setAttributeNS(null,"dy","0.35em"),a.setAttributeNS(null,"stroke","#080808"),a.setAttributeNS(null,"fill","#080808"),a.textContent=n,d.appendChild(a);const m=a.cloneNode(!0);m.setAttributeNS(null,"x",675),d.appendChild(m)}const S=document.createElementNS(o,"g");S.setAttributeNS(null,"id",`stonesGroup-${n}-${r}`),c.appendChild(S);for(let t=0;t<s;t++)for(let e=0;e<s;e++){const s=l+t*u,i=l+e*u,c=document.createElementNS(o,"image");c.setAttributeNS(null,"x",s-16.5),c.setAttributeNS(null,"y",i-16.5),c.setAttributeNS(null,"width",33),c.setAttributeNS(null,"height",33),c.setAttributeNS("http://www.w3.org/1999/xlink","href",""),c.setAttributeNS(null,"id",`stone-${t}-${e}-${n}-${r}`),S.appendChild(c)}const h=document.getElementById(t),b=h.parentElement,A=Math.min(b.clientWidth,b.clientHeight);h?b?(h.style.width=`${A}px`,h.style.height=`${A}px`,h.style.backgroundImage=`url(${e.src})`,h.innerHTML="",h.appendChild(c)):console.error(`Parent element of '${t}' not found.`):console.error(`Element with ID '${t}' not found.`)}function loadSocket(){const t=io("https://online-go.com",{transports:["websocket"]});return t.on("connect",(()=>{console.log("OGS connected"),t.emit("hostinfo"),t.emit("authenticate",{device_id:"bubble-viewer"})})),t.on("hostinfo",(t=>{console.log("Termination server",t)})),t.on("authenticate",(t=>{console.log(t)})),t.on("disconnect",(()=>{console.log("Disconnected from OGS. Attempting to reconnect...")})),t.on("error",(t=>{console.error("Socket connection error:",t)})),t}
    </script>
  </body>
</html>
